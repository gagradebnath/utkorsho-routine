<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utkorsho Routine</title>
    <!-- Include Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
      /* Custom CSS for additional styling */
      .logo-container {
          text-align: center;
          padding: 20px 0;
      }

      .logo-container img {
          max-height: 60px; /* Adjust height as needed */
      }    

        #loading-spinner {
        position: absolute;
        top: 50%;
        left: 50%;
    }

  </style>
</head>
<body>
    <div class="container">
        <!-- Logo -->
        <div class="row">
          <div class="col-12 logo-container">
              <img src="https://www.utkorsho.tech/_next/static/media/UtkorshoLogo.11e531db.svg" alt="Logo" class="img-fluid">
              <h1 class="my-4" style="color: rgba(9,174,134,255); font-size:2rem;">Utkorsho Routine</h1>
          </div>
      </div>

        <!-- Dropdown for table selection -->
        <div class="form-group">
            <!-- <label for="tableSelect">Select Table:</label> -->
            <select class="form-control" id="tableSelect" onchange="showSelectedTable()">
                <!-- Table names will be dynamically populated here -->
            </select>
        </div>

    <div id="tables-container" class="table-responsive">
        <div id="loading-spinner" class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>

    </div>
    </div>

    <!-- Include Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        // URL of the public Google Sheets document
        const sheetURL = 'https://docs.google.com/spreadsheets/u/0/d/e/2PACX-1vSr7Oq0GJLmhZREeiBoWrHo4bTtM-XzTNxaE3wuA8MtgIDaBYM3f_2e_Cgb4p7m8KF1AcCcwLb-14OB/pubhtml?pli=1#';

        // Function to fetch and parse the tables from the Google Sheets document
        async function fetchTables() {
            try {
                // Fetch the HTML content of the Google Sheets document
                const response = await fetch(sheetURL);
                const text = await response.text();

                // Create a DOM parser to parse the HTML content
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');

                // Extract table names from the list at the top
                const listItems = doc.querySelectorAll('ul li');
                const tableNames = Array.from(listItems).map(li => li.textContent.trim());

                // Select all tables from the parsed HTML
                const tables = doc.querySelectorAll('table');

                // Container to display the tables
                const container = document.getElementById('tables-container');

                // Dropdown menu for table selection
                const tableSelect = document.getElementById('tableSelect');
                tableNames.forEach((tableName, index) => {
                    const option = document.createElement('option');
                    option.value = index.toString();
                    option.textContent = tableName;
                    tableSelect.appendChild(option);
                });

                // Display the first table by default
                showTable(0);

                // Function to show the selected table
                window.showSelectedTable = function() {
                    var selectedIndex = parseInt(tableSelect.value);
                    showTable(selectedIndex);
                }

                // Function to show the selected table
                function showTable(index) {

                    // Clear previous table if any
                    container.innerHTML = '';

                    // Clone the selected table and append it to the container
                    const clonedTable = tables[index].cloneNode(true);
                    const rows = clonedTable.querySelectorAll('tr');
                    

                    rows.forEach(row => {
                        const cells = row.querySelectorAll('td, th');

                        // Remove the first cell in each row
                        if (cells.length > 0) {
                            cells[0].remove();
                        }

                        //table header bg color
                        let shouldHighlightRow = false;

                        cells.forEach(cell => {
                            // Check if the cell contains specific text
                            if (cell.textContent.includes('Date') ||
                                cell.textContent.includes('উৎকর্ষ নোটিশ বোর্ড')||
                                cell.textContent.includes('আগামীকালের')||
                                cell.textContent.includes('আজকের')||
                                cell.textContent.includes('পরশুদিনের')||
                                cell.textContent.includes('কোর্সের নাম') ||
                                cell.textContent.includes('Class Routine') ||
                                cell.textContent.includes('Exam Routine') ||
                                cell.textContent.includes(tableNames[index])) { // Assuming tableNames is an array of table names
                                shouldHighlightRow = true;
                            }
                        });

                        // Apply background color and text styles if needed
                        if (shouldHighlightRow) {
                            row.style.backgroundColor = 'rgba(9, 174, 134, 1)'; // Background color
                            row.style.color = 'white'; // Text color
                            row.style.fontWeight = 'bold'; // Bold text
                        }

                        // Process "class done" and "exam done" cells
                        cells.forEach(cell => {
                            if (cell.innerHTML.includes('<use href="#checked-checkbox-id" fill="#000000"></use>')||cell.innerHTML.includes('TRUE')) {
                                cell.innerHTML = '<span>&#10004;</span>'; // Display tick mark
                            } else if (cell.innerHTML.includes('<use href="#unchecked-checkbox-id" fill="#000000"></use>')) {
                                cell.textContent = 'Pending'; // Display "Pending"
                            }
                        });


                        // Check if any cell contains specific texts to omit the row
                        let shouldOmitRow = false;
                        cells.forEach(cell => {
                            if (cell.textContent.includes('আজকের ক্লাস রুটিন দেখতে ক্লিক করো') ||
                                cell.textContent.includes('৩। পরীক্ষার নিয়মাবলী পরীক্ষার শুরুতে ওয়েবসাইটে লেখা থাকবে।') ||
                                cell.textContent.includes('২। পরীক্ষার তারিখ নিচের রুটিনে দেয়া আছে। ') ||
                                cell.textContent.includes('১। পরীক্ষা হবে') ||
                                cell.textContent.includes('সকল ক্লাস রুটিন দেখতে ক্লিক করো')) {
                                shouldOmitRow = true;
                            }
                        });

                        // Remove the row if it should be omitted
                        if (shouldOmitRow) {
                            row.remove();
                        }

                        // Check if all remaining cells are empty
                        let isEmptyRow = true;
                        cells.forEach(cell => {
                            if (cell.textContent.trim() !== '') {
                                isEmptyRow = false;
                            }
                        });

                        // Remove the row if all cells are empty
                        if (isEmptyRow) {
                            row.remove();
                        }
                    });

                    // Add Bootstrap table classes
                    clonedTable.classList.add('table', 'table-bordered', 'table-striped', 'table-hover' );

                    container.appendChild(clonedTable);
                }
            } catch (error) {
                console.error('Error fetching or parsing tables:', error);
            }
        }

        // Fetch and display the tables when the page loads
        window.onload = fetchTables;
    </script>
</body>
</html>
